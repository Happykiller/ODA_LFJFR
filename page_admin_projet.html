<!DOCTYPE html> 
<html>
  <head>
    <!--META-->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=0.75">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge">

    <!--CSS-->
    <link rel="stylesheet" href="API/css/themes/default/jquery.mobile.min.css" />
    <link rel="stylesheet" href="API/css/themes/default/jquery.mobile.structure.min.css" />
    <!--<link rel="stylesheet" href="API/css/datatables/css/jquery.dataTables.css"/>--> 
    <link rel="stylesheet" href="API/css/mycss.css" />
    <link rel="stylesheet" href="css/mycss.css" />

    <!--JS-->
    <script type="text/javascript" src="API/js/jquery.min.js"></script>
    <script type="text/javascript" src="API/js/jquery.mobile.min.js"></script>
    <!--<script type="text/javascript" src="API/js/highcharts.js"></script>-->
    <!--<script type="text/javascript" src="API/js/modules/exporting.js"></script>-->
    <!--<script type="text/javascript" src="API/js/jquery.dataTables.min.js"></script>--> 
    <script type="text/javascript" src="include/config.js"></script>
    <script type="text/javascript" src="API/js/fonctions.js"></script>
    <script type="text/javascript" src="js/fonctions.js"></script>

    <script type="text/javascript">
    checkMaintenance();
    checkAuthentification();
    
    ///////////////////
    //BLOCK VARIABLE GLOBAL
    ///////////////////
    var id_page = 21;

    ///////////////////
    //BLOCK FONCTIONS EVENEMENTS
    ///////////////////
    //A la construction de la page
    $(document).on('pageinit',function() {
        try {
            // Init commmun
            init_commun();

            // Init page
        } catch (er) {
            log(0, "ERROR(init_home):" + er.message);
        }
    });

    //Affichage de la page avant onload
    $(document).on('pageshow',function() {
        try {
            show_commun();
        } catch (er) {
            log(0, "ERROR(show):" + er.message);
        }
    });

    //Fin chargement page
    function OnLoad() {
        try {
            //
        } catch (er) {
            log(0, "ERROR(OnLoad):" + er.message);
        }
    }

    ///////////////////
    //BLOCK FONCTIONS METIER
    ///////////////////
    /**
     * creerCompte
     */
    function creerCompte(){
        try {
            var input_nom = $("#input_nom").val();
            var input_cle = $("#input_cle").val();
            var input_code_user = $("#input_code_user").val();
            var input_mail = $("#input_mail").val();
            var input_description = $("#input_description").val();
            var input_cv = $("#input_cv").val();
            
            if((input_nom != "")&&(input_cle != "")&&(input_code_user != "")&&(input_mail != "")&&(input_cv != "")){
                notification("Merci de patienter ...", _INFO);
                var tabInput = { input_nom : input_nom, input_cle : input_cle, input_code_user : input_code_user, input_mail : input_mail, input_description: input_description, input_cv : input_cv  };
                callBD("phpsql/creerCompte.php", "POST", "text", tabInput, "retourCreerCompte");  
            } else{
                notification("Problème avec les inputs", _WARNING);
            }       
        } catch (er) {
            log(0, "ERROR(creerCompte):" + er.message);
        }
    }

    ///////////////////
    //BLOCK FONCTIONS TECHNIQUE
    ///////////////////

    ///////////////////
    //BLOCK FONCTIONS AFFICHAGE
    ///////////////////
    /**
     * retourCreerCompte
     * 
     * @param {array} p_retour
     */
    function retourCreerCompte(p_retour){
        try {
            var json_retour = JSON.parse(p_retour);
            if(json_retour["strErreur"] == ""){
                
                var nom_pdf = "CV_ROSITOF_"+$("#input_code_user").val()+".pdf";
                uploadFile("input_cv","pj/",nom_pdf);
                
                $("#input_cv").val("");
                $("#input_nom").val("");
                $("#input_cle").val("");
                $("#input_code_user").val("");
                $("#input_mail").val("");
                $("#input_description").val("");
                
                notification("Compte créé num : "+json_retour["data"]["resultatInsert"], _SUCCES);
            } else{
                notification("Erreur : "+json_retour["strErreur"], _ALERT);
            }
        } catch (er) {
            log(0, "ERROR(retourCreerCompte):" + er.message);
        }
    }
</script>

</head>
<body onload="OnLoad();">

    <!-- page -->
    <div data-role="page" data-title="Titre">

        <!-- /panel -->
        <div data-role="panel" id="mypanel" data-display="overlay" data-position="left">

        </div>
        <!-- /panel -->

        <!-- header -->
        <div data-role="header" data-position="fixed">
            <a href="#mypanel" data-role="button" data-icon="home" data-iconpos="notext">home</a>
            <h1 id="id_titre">titre</h1>
            <a href="javascript:window.location = ('./page_contact.html?mili='+getMilise());" data-role="button" data-icon="info" data-iconpos="notext">Contact</a>
        </div>
        <!-- /header -->
        
        <!-- navbar -->
        <!-- /navbar -->

        <!-- content -->
        <div data-role="content" id="main_content">
            <div data-role="collapsible" data-collapsed="false" data-mini="true">
                <h3>Créer un profile</h3>
                Nom : <input id="input_nom" type="text">
                Clé : <input id="input_cle" type="text">
                Code utilisateur :<input id="input_code_user" type="text">
                Mail : <input id="input_mail" type="email">
                Description : <input id="input_description" type="text">
                <label for="input_cv">CV :</label>
                <input type="file" name="input_cv" id="input_cv" data-clear-btn="true">
                <a href="javascript:creerCompte();" data-role="button" data-inline="true" data-icon="arrow-r" data-mini="true">Soumettre</a>
            </div>       
        </div>
        <!-- /content -->

        <!-- footer -->
        <div data-role="footer" data-position="fixed">
            <a data-role="button" data-icon="search" data-iconpos="notext" class="ui-btn-left" href="javascript:window.location = ('./page_faq.html?mili='+getMilise());">FAQ</a>
            <h1 id="id_affichageUser">User</h1>
            <a data-role="button" data-icon="delete" data-iconpos="notext" class="ui-btn-right" href="javascript:window.location = ('./page_sortie.html?mili='+getMilise());">Logout</a>
        </div>
        <!-- /footer -->

    </div>
    <!-- /page -->
</body>
</html>